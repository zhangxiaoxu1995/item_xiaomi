<link rel="stylesheet" href="../css/xiangqing_center.css">
<div id="centers">
    <div id="xiding">
        <div class="content">
            <span class="shop_name">Redmi 7A 移动4G+版</span>
            <span>用户评价</span>
        </div>
    </div>
    <div id="center_main">
        <div class="content clearfix">
            <div class="left fl">
                <div id="lunbo">
                    <div class="zhezhao"></div>
                    <div class="copy">
                        <img src="https://i1.mifile.cn/a1/pms_1558857753.92246453!560x560.jpg" alt="">
                    </div>
                    <ul class="imglist">
                        <!-- <li><img src="../images/pic1.jpg" alt=""></li> -->
                    </ul>
                    <p class="light">
                        <!-- <span></span> -->
                    </p>
                    <div class="posibtn">
                        <span class="prev"></span>
                        <span class="next"></span>
                    </div>
                </div>
            </div>
            <div class="right fl">
                <h2 class="shop_name">小米9</h2>
                <p class="jieshao">全曲面轻薄设计，全息幻彩玻璃机身 / 骁龙855旗舰处理器 / 20W无线闪充，标配27W有线快充 / 索尼4800万超广角微距三摄 / 极速屏下指纹解锁 / 多功能NFC</p>
                <h3>小米自营</h3>
                <div class="shop_price">
                    <span class="now_price">2599元</span>
                    <!-- <span>2999元</span> -->
                </div>
                <hr>
                <div class="dizhi">
                    <p>广州&nbsp;广州市&nbsp;荔湾区&nbsp;白鹤洞街道
                        <span>修改</span>
                    </p>
                    <p>
                        <span>有现货</span>
                    </p>
                </div>
                <div class="fuwu">
                    <div class="yanse">
                        <div class="fuwu_title">选择颜色</div>
                        <div class="fuwu_kuang" style="border-color:#ff6700">晨曦蓝
                            <span class="now_price">699元</span>
                        </div>
                        <div class="fuwu_kuang">磨砂黑
                            <span class="now_price">699元</span>
                        </div>
                    </div>
                    <div class="rongliang">
                        <div class="fuwu_title">选择容量</div>
                        <div class="fuwu_kuang" style="border-color:#ff6700">32G</span>
                        </div>
                    </div>
                    <div class="yiwai">
                        <div class="fuwu_title">选择小米提供的意外保护</div>
                        <div class="yiwai_fuwu clearfix">
                            <div class="left fl">
                                <input type="radio" name="yiwai" id="" class="danxuan">
                                <img src="http://i1.mifile.cn/a1/pms_1561968669.45567829.png?width=50&height=50" alt="">
                            </div>
                            <div class="right fl">
                                <p>意外保障服务</p>
                                <p>手机意外碎屏/进水/碾压等损坏</p>
                                <div class="p3">
                                    <div>
                                        <input type="checkbox">我已阅读
                                        <span>服务条款</span>
                                        <i>|</i>
                                        <span>常见问题</span>
                                    </div>
                                    <div>99元</div>
                                </div>
                            </div>
                        </div>
                        <div class="yiwai_fuwu">
                            <div class="left fl">
                                <input type="radio" name="yiwai" id="" class="danxuan">
                                <img src=" http://i1.mifile.cn/a1/pms_1561968669.45567829.png?width=50&height=50 " alt=" ">
                            </div>
                            <div class="right fl ">
                                <p>碎屏保障服务</p>
                                <p>手机意外碎屏/进水/碾压等损坏</p>
                                <div class="p3 ">
                                    <div>
                                        <input type="checkbox">我已阅读
                                        <span>服务条款</span>
                                        <i>|</i>
                                        <span>常见问题</span>
                                    </div>
                                    <div>59元</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="yiwai yanbao ">
                        <div class="fuwu_title ">选择小米提供的延长保修</div>
                        <div class="yiwai_fuwu ">
                            <div class="left fl ">
                                <input type="radio" name=" " id=" ">
                                <img src="http://i1.mifile.cn/a1/pms_1561968669.45567829.png?width=50&height=50 " alt=" ">
                            </div>
                            <div class="right fl ">
                                <p>延长保修服务</p>
                                <p>厂保延一年，性能故障免费维修</p>
                                <div class="p3 ">
                                    <div>
                                        <input type="checkbox">我已阅读
                                        <span>服务条款</span>
                                        <i>|</i>
                                        <span>常见问题</span>
                                    </div>
                                    <div>29元</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="zongji ">
                        <p>
                            <span class="shop_name">小米CC9e 4GB+128GB 白色恋人</span>
                            <span class="now_price">699元</span>
                        </p>
                        <p>总计：
                            <span class="now_price">699元</span>
                        </p>
                    </div>
                    <div class="jiaru ">
                        <span class="jiaru_car">加入购物车</span>
                        <span>喜欢</span>
                    </div>
                    <img src="../images/qitian.jpg " alt=" ">
                </div>
            </div>
        </div>
    </div>
    <div id="price_shuoming ">
        <div class="content ">
            <h5>价格说明</h5>
            <img src="https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/a482afa34053b1b32ece1023475af7fb.jpeg " alt=" ">
        </div>
    </div>
</div>
<script src="../js/lunbotu3.js"></script>
<script>
    ; (function () {
        var xiangqing_first = decodeURI(location.search);//中文解码
        var xiangqing_two = xiangqing_first.slice(1)//切割?
        var xiangqing_three = xiangqing_two.slice(9)//id值

        let huoqu = new Promise(resolved => {
            $.ajax({
                type: 'get',
                url: '../api/xiangqing.php',
                data: {
                    uid: xiangqing_three
                },
                success: str => {
                    let show_like_arr = JSON.parse(str);
                    resolved(show_like_arr)
                }
            });
        });

        huoqu.then(chushi_str => {
            let xiangqing_xuanran = chushi_str[0];
            let list_names = xiangqing_xuanran.list_name;
            let now_price = xiangqing_xuanran.now_price;
            $('.shop_name').html(list_names);
            $('.now_price').html(now_price + "元");
            let new_arr = Object.values(xiangqing_xuanran);
            let small_list = new_arr.slice(5);
            let new_small_list = small_list.map(function (item) {
                var reg = /34x34/g;
                return item.replace(reg, '560x560')

            })
            // 轮播图
            carouselimg({
                ele: 'lunbo',
                imgdate: new_small_list
            });
        });

        //轮播图+吸顶菜单
        window.onscroll = function () {//绑定滚动事件
            var scrollTop = window.scrollY//不断获取到顶部的距离
            if (scrollTop > 200) {//当到顶部距离超出可视窗口一屏距离出现点击按钮
                $('#xiding').css({
                    'position': 'fixed',
                    'top': '0px',
                    'left': '0',
                    'z-index': '49'
                });
            } else {
                $('#xiding').css({
                    'position': 'static',
                });
            };

            if (scrollTop >= 250 && scrollTop < 1060) {//当到顶部距离超出可视窗口一屏距离出现点击按钮
                $('#lunbo').css({
                    'position': 'fixed',
                    'top': '55px',
                    'z-index': '29',
                    'margin-top': '0px'
                });
            }
            else if (scrollTop >= 1060) {
                $('#lunbo').css({
                    'position': 'static',
                    'margin-top': '800px'
                });
            }
            else if (scrollTop < 250) {
                $('#lunbo').css({
                    'position': 'relative',
                    'margin-top': '0px',
                    "top": '0'
                });
            }
        };

        // 2、颜色选择——边框颜色
        $('.yanse .fuwu_kuang').click(function () {
            $(this).css('border-color', '#ff6700').siblings().css('border-color', '#e0e0e0')
        });
        // 3、点击单选框——意外服务切换
        $('.yiwai .yiwai_fuwu').click(function () {
            $(this).css('border-color', '#ff6700').siblings().css('border-color', '#e0e0e0');
            $(this).find('.right').first().css('color', '#ff6700')
            if ($(this).css('border-color') == 'rgb(255, 103, 0)') {
                $(this).find('input:radio').prop("checked", 'true')
            };
        });

        //4、放大镜
        $('#lunbo').hover(function () {//移入、移出，遮罩层和放大层出现，隐藏
            $('.copy').css('display', 'block');
            $('.zhezhao').css('display', 'block');
        }, function () {
            $('.copy').css('display', 'none');
            $('.zhezhao').css('display', 'none');
        })

        //滑动原图时，将原图的src路径，同步到放大层的src路径里
        $('.imglist').on('mouseover', 'li img', function () {
            $('.copy img').attr('src', $(this).attr('src'))
        })


        //遮罩层移动
        $('#lunbo').mousemove(function (ev) {
            let zuobian = (ev.pageX) - ($('#lunbo').offset().left) - (($('.zhezhao').innerWidth()) / 2);
            let shangbian = (ev.pageY) - ($('#lunbo').offset().top) - (($('.zhezhao').innerHeight()) / 2);
            if (zuobian <= 40) {
                zuobian = 40
            } else if (zuobian > $('#lunbo').innerWidth() - $('.zhezhao').innerWidth()) {
                zuobian = $('#lunbo').innerHeight() - $('.zhezhao').innerHeight() - 40
            }
            if (shangbian <= 0) {
                shangbian = 0
            } else if (shangbian > $('#lunbo').innerHeight() - $('.zhezhao').innerHeight()) {
                shangbian = $('#lunbo').innerHeight() - $('.zhezhao').innerHeight()-40
            }
            $('.zhezhao').css('left', zuobian + 'px');
            $('.zhezhao').css('top', shangbian + 'px');

            //遮罩层移动比例
            var scalX = zuobian / ($('#lunbo').innerWidth() - $('.zhezhao').innerWidth());
            var scalY = shangbian / ($('#lunbo').innerHeight() - $('.zhezhao').innerHeight());


            $('.copy img').css('left', -(($('.copy img').innerWidth()) - ($('.copy').innerWidth())) * scalX + 'px');
            $('.copy img').css('top', -(($('.copy img').innerHeight()) - ($('.copy').innerHeight())) * scalY + 'px');

        });
        //点击加入购物车，获取cookie里面的用户名，和商品uid,将其存入订单列表
        $('.jiaru_car').click(function () {
            let use_name = getcookie('name');
            let shop_uid = xiangqing_three;
            $.ajax({
                type: 'get',
                url: '../api/dingdan.php',
                data: {
                    use_name: use_name,
                    shop_uid: shop_uid
                },
                success: str => {
                    window.open('gouwuche.html');
                }
            });
        });


    })();
</script>